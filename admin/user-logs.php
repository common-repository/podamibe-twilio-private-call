<?phpif ( ! defined( 'ABSPATH' ) ) {	exit; // Exit if accessed directly}class POD_Twilio_Admin_User_Logs {	/**	*	@var integer	*	@private	*	user id	**/	private $_id;		/**	*	@var array	*	@private	*	user log navigation tab array	*/	private $_nav_tabs;		/**	*	@var string	*	@private	*	current nav tab	**/	private $_current_tab;		/**	*	@var object	*	@private	*	user logs class	**/	private $_user_logs;		/**	*	@var object	*	@private	*	user payment history class	**/	private $_payment_history;		/*		*	@array	*	@private	*	user details of of provided user id	*/	private $_user_details;			/**	* 	@var integer	*	@private	* 	limit variable for call log for pagination	*/	private $_limit_call_logs;		/**	* 	@var integer	*	@private	* 	limit variable for payment log for pagination	*/	private $_limit_payment_logs;		/* 	*	@var integer	*	@private	*	paginate number	*/	private $_pagenum;		private $_user;		public function __construct( $user_id ){		$this->_limit_call_logs = apply_filters( "pod_twilio_admin_call_logs_limit", 10 );		$this->_limit_payment_logs = apply_filters( "pod_twilio_admin_payment_logs_limit", 10 );		$this->_pagenum = isset( $_GET['pagenum'] ) ? absint( $_GET['pagenum'] ) : 1;				$this->_id = $user_id;		$this->_user = new POD_Twilio_User( $this->_id );		$this->_user_details = $this->_user->twilio_user_details;		$this->_nav_tabs = $this->user_log_nav_tabs();		$this->_current_tab = $this->get_current_tab();		$this->_user_logs = new POD_Twilio_User_Logs( $this->_id );		$this->_payment_history = new POD_Twilio_Payment_History( $this->_id );	}		/**	*	@param null	*	@private	*	@return array	*	This method load the navigation tabs	**/	private function user_log_nav_tabs(){		$nav_tabs = array(				array(					"label"		=> esc_html__( "Call Logs", POD_TWILIO_TEXT_DOMAIN ),					"slug" 		=> "call_log",					"callback" 	=> array( $this, "load_user_logs" )				),				array(					"label" 	=> esc_html__( "Payment History", POD_TWILIO_TEXT_DOMAIN ),					"slug" 		=> "payment_history",					"callback" 	=> array( $this, "view_payment_history" )				)			);		return apply_filters("pod_twilio_user_log_nav_tabs",$nav_tabs);	}		/**	*	@param null	*	@private	*	@return string	*	This method returns the current navigation tab	**/	private function get_current_tab(){		if( ! isset( $_GET['tab'] ) || empty( $_GET['tab'] ) ){			$current_tab = "call_log";		}		else{			$current_tab = trim( $_GET['tab'] );		}		return $current_tab;	}		/**	*	@param null	*	@private	*	@return void	*	loads navigation tabs	**/	private function load_user_log_nav_tabs(){?>		<div class="wrap">			<h1><?php esc_html_e( "User Logs: ", POD_TWILIO_TEXT_DOMAIN ) . ucwords( $this->_user->get_user_name() ) ; ?></h1>			<h2 class="nav-tab-wrapper">			<?php				foreach( $this->_nav_tabs as $nav_tab ){						$active = ( $nav_tab['slug'] == $this->_current_tab ) ? "nav-tab-active":"";					echo "<a href=\"?page=pod_twilio_users&id=".$this->_id."&action=view_logs&tab=".$nav_tab["slug"]."\" class=\"nav-tab ".$active."\">".__( $nav_tab['label'], POD_TWILIO_TEXT_DOMAIN )."</a>";				}			?>			<h2>					</div><?php	}		/**	*	@param null	*	@public	*	@return void	*	loads content according to the active tab	**/	public function load_user_logs_view(){		$this->load_user_log_nav_tabs();				$callbacks = array_column( $this->_nav_tabs, "callback", 'slug' );		//rearrange nav_tab array in format array("slug"=>"callback")		call_user_func( $callbacks[$this->_current_tab] );		//load content according to current tab using callback function	}		/**	*	@param null	*	@public	*	@return void	*	view user logs	**/	public function load_user_logs(){	?>		<div class="wrap">			<p class="about-description"><h4><?php esc_html_e( "User's Call History", POD_TWILIO_TEXT_DOMAIN ); ?><h4></p>		<?php		try{			$total_calls = $this->_user_logs->total_call_logs();			$call_logs = $this->_user_logs->get_user_call_logs();			if( ! empty( $call_logs ) ){		?>				<table class="wp-list-table widefat fixed striped pages">					<thead>						<tr valign="top">							<th scope="row"><?php esc_html_e( "S.N.", POD_TWILIO_TEXT_DOMAIN ); ?></th>													<th scope="row"><?php esc_html_e( "Start Time", POD_TWILIO_TEXT_DOMAIN ); ?></th>							<th scope="row"><?php esc_html_e( "Duration", POD_TWILIO_TEXT_DOMAIN ); ?></th>											<th scope="row"><?php esc_html_e( "Direction", POD_TWILIO_TEXT_DOMAIN ); ?></th>											<th scope="row"><?php esc_html_e( "From", POD_TWILIO_TEXT_DOMAIN ); ?></th>													<th scope="row"><?php esc_html_e( "To", POD_TWILIO_TEXT_DOMAIN ); ?></th>													<th scope="row"><?php esc_html_e( "Status", POD_TWILIO_TEXT_DOMAIN ); ?></th>											</tr>					</thead>					<tbody>			<?php				$sn = ( ( $this->_pagenum - 1 ) * ( $this->_limit_call_logs ) ) + 1;				foreach( $call_logs as $call ){			?>					<tr valign="top">						<td><?php echo $sn; ?></td>						<td><?php echo $call->startTime->format("Y-m-d H:i:s"); ?></td>						<td><?php echo $call->duration; ?></td>						<td><?php echo $call->direction; ?></td>						<td><?php echo $call->from; ?></td>						<td><?php echo $call->to; ?></td>						<td><?php echo $call->status; ?></td>					</tr>			<?php					$sn++;				}			?>					</tbody>				</table>		<?php				$num_of_pages = ceil( $total_calls / $this->_limit_call_logs );			}			else{		?>				<p class="about-description"><h3><?php esc_html_e( "No Calls has been made.", POD_TWILIO_TEXT_DOMAIN ); ?><h3></p>		<?php			}					}		catch( Exception $e ){			echo $e->getMessage();		}		?>		</div>	<?php	}		/**	*	@param null	*	@public	*	@return void	*	view user payment history	**/	public function view_payment_history(){		$user_payment_history = $this->_payment_history->get_user_payment_history_with_pagination( $this->_limit_payment_logs, $this->_pagenum );?>		<div class="wrap">			<p class="about-description"><h4><?php esc_html_e( "User's Payment History", POD_TWILIO_TEXT_DOMAIN ); ?><h4></p>			<table class="wp-list-table widefat fixed striped pages">				<thead>					<tr valign="top">						<th scope="row"><?php esc_html_e( "S.N.", POD_TWILIO_TEXT_DOMAIN ); ?></th>						<th scope="row"><?php esc_html_e( "Payment Date", POD_TWILIO_TEXT_DOMAIN ); ?></th>						<th scope="row"><?PHP esc_html_e( "Amount", POD_TWILIO_TEXT_DOMAIN ); ?></th>						<th scope="row"><?PHP esc_html_e( "Payment Method", POD_TWILIO_TEXT_DOMAIN ); ?></th>?>						<th scope="row"><?PHP esc_html_e( "Call Time Bought", POD_TWILIO_TEXT_DOMAIN ); ?></th>					</tr>				</thead>				<tbody>				<?php						$sn = ( ( $this->_pagenum - 1 ) * ( $this->_limit_payment_logs ) ) + 1;							foreach( $user_payment_history as $payment_history ){							?>					<tr valign="top">						<td><?php echo $sn; ?></td>						<td><?php echo $payment_history->payment_date; ?></td>							<td><?php echo $payment_history->amount; ?></td>						<td><?php echo $payment_history->payment_method; ?></td>						<td><?php echo pod_twilio_format_call_duration( $payment_history->bought_call_time ); ?></td>					</tr>				<?php 					$sn++;				}				?>				</tbody>			</table>			<?php 				$num_of_pages = ceil( $this->_payment_history->_total_logs / $this->_limit_payment_logs );		//total pages = total_payment_logs/logs_per_page				pod_twilio_paginate_links($num_of_pages,$this->_pagenum);		//show pagination links 			?>		</div><?php	}}