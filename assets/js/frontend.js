( function( $ ){	$(document).ready(function(){		/*		*	toggle display tab and content in user profile page		*/		$( "a.pod-twilio-show-tab-content" ).click( function() {			var show = $( this ).data( "tab" );			$( "a.pod-twilio-show-tab-content" ).removeClass( "pod-twilio-active-tab" );			$( this ).addClass( "pod-twilio-active-tab" );			$( ".pod-twilio-tab-content" ).hide();			$( show ).show();		});				/*		*	calculate total price		*/		$( "input#call-duration.call-duration" ).on( "keyup change", function() {			var call_duration = $( this ).val();			var call_price = parseFloat( pod_twilio.pod_twilio_master_ac_settings.call_cost_per_minute );			if( isNaN( call_duration ) ) {				call_duration = String( 0 );				$( this ).val("");				total_price = parseFloat( call_duration * call_price ) . toFixed( 2 );			}			else{				if( call_duration != "" && Math.ceil( call_duration ) != parseInt( call_duration ) ) {										call_duration =  String( Math.floor( call_duration ) );					$(this).val( call_duration );									}			}			var total_price = parseFloat( call_duration * call_price ) . toFixed( 2 );			buy_call_duration.amount.value = total_price;			buy_call_duration.custom.value = call_duration.replace( /\./g,"" );			$( "span#show-total-price.show-total-price" ).text( format_amount_with_currency( total_price ) );		});				/*		*	sent contact request to users		*/		$( ".pod-twilio-add-to-contact" ).live( "click", function() {			var btn = $( this );			var request_user_id = $( this ).data( "user-id" );			var btn_text = btn.text();			$.ajax({				url: pod_twilio.ajaxurl,				method: "post",				dataType: "json",				data: { "action": "pod_twilio_add_to_contact", "request_user_id":request_user_id },				success: function ( result ){					if( result.status == "success" ){						btn.text( "Added" ).removeClass("pod-twilio-add-to-contact");					}					else{						alert( result.message );						btn.text( btn_text );					}					btn.attr("disabled", false);				},				beforeSend: function ( ){					btn.attr("disabled", true);					btn.html( btn_text+"&nbsp;<i class=\"fa fa-circle-o-notch fa-spin\"></i>" );				}			});		} );				$( ".pod-twilio-accept-request" ).live( "click", function() {			var btn = $( this );			var request_user_id = $( this ).data( "contact-user-id" );			var reject = $( this ).data( "action" );						var container = btn.parent();						var conainer_html = container.html();						var is_reject = ( "reject" == reject );						$.ajax({				url: pod_twilio.ajaxurl,				method: "post",				dataType: "json",				data: { "action": "pod_twilio_accept_contact_request", "request_user_id":request_user_id,"reject": is_reject },				success: function ( result ){					if( result.status == "success" ){						if( ! is_reject ){							alert( result.message + ". Please verify your number." );							container.html( "<a class=\"action-btn pod-twilio-verify-number\" data-contact-user-id=\""+ request_user_id +"\">Verify</a>" );						}						else{							container.closest( "ul" ).fadeOut( function() {								$(this).remove()							} );						}					}					else{						alert( result.message );						container.html( conainer_html );					}				},				beforeSend: function ( ){					container.html("<a class=\"action-btn\">Please Wait&nbsp;<i class=\"fa fa-circle-o-notch fa-spin\"></i></a>");				},				error: function( jqXHR, textStatus, errorThrown ){					alert( "request failed : " + errorThrown );					container.html( conainer_html );				}			});		} );				var current_page_verified = 2;		$( "#pod-twilio-contacts #show-more-verified-contacts button" ).live("click", function(){			var load_more_container = $( this ).parent();			var limit = 10;			var offset = ( current_page_verified - 1 ) * limit;				$.ajax({				url: pod_twilio.ajaxurl,				method: "post",				dataType: "json",				data: { "action": "pod_twilio_load_more_verified_contacts", "limit": limit, "offset": offset },				success: function ( result ){					$( result.contact_details_html ).insertBefore( load_more_container );					if( result.count == 0 ){						load_more_container.empty();					}					else{						load_more_container.html( "<button>Show More</button>" );					}					current_page_verified++;				},				beforeSend: function ( ){					load_more_container.html( "<i class=\"fa fa-circle-o-notch fa-spin\"></i>" );				},				error: function( jqXHR, textStatus, errorThrown ){					alert( "request failed : "+errorThrown );					load_more_container.html( "<button>Show More</button>" );				}			});		});				var current_page_pending = 2;		$( "#pod-twilio-contacts #show-more-pending-contacts button" ).live("click", function() {			var load_more_container = $( this ).parent();			var limit = 10;			var offset = ( current_page_pending - 1 ) * limit;				$.ajax({				url: pod_twilio.ajaxurl,				method: "post",				dataType: "json",				data: { "action": "pod_twilio_load_more_pending_contacts", "limit": limit, "offset": offset },				success: function ( result ) {					$( result.contact_details_html ).insertBefore( load_more_container );					if( result.count == 0 ) {						load_more_container.empty();					}					else{						load_more_container.html( "<button>Show More</button>" );					}					current_page_pending++;				},				beforeSend: function () {					load_more_container.html( "<i class=\"fa fa-circle-o-notch fa-spin\"></i>" );				},				error: function( jqXHR, textStatus, errorThrown ){					alert( "request failed : "+errorThrown );					load_more_container.html( "<button>Show More</button>" );				}			});		});				$( ".pod-twilio-remove-contact" ).click( function() {			var btn = $( this );			var user_id = btn.data( "user-id" );			var btn_text = btn.text();			$.ajax({				url: pod_twilio.ajaxurl,				method: "post",				dataType: "json",				data: { "action" : "pod_twilio_remove_contact", "request_user_id" : user_id },				success: function ( result ){					if( result.status == "success" ){						btn.closest("ul").fadeOut( function() {							$(this).remove()						} );					}					else{						alert( result.message );						btn.closest("ul").fadeOut( function() {							$(this).remove()						} );					}				},				beforeSend: function(  ){					btn.html( btn_text+"&nbsp;<i class=\"fa fa-circle-o-notch fa-spin\"></i>" );				},				error: function( jqXHR, textStatus, errorThrown ){					alert( "request failed : " + errorThrown );					btn.html( btn_text );				}			}); 		});			var check_number_verified = function( btn, contact_user_id ){			var btn_text = btn.text();			$.ajax({				url: pod_twilio.ajaxurl,				method: "post",				dataType: "json",				data: { "action" : "pod_twilio_check_number_verified", "contact_user_id" : contact_user_id },				success: function( response ){					var button = "";					if( response.status == "success" ) {							if( response.contact_status == "In Contact" ) {							button = "<button onclick=\"window.location.reload();\">OK</button>";						}						else{							btn.removeClass( "pod-twilio-verify-number" );							btn.html( response.contact_status );							button = "<button onclick=\"tb_remove();\">OK</button>";						}					}					else{						button = "<button onclick=\"tb_remove();\">OK</button>";						btn.html( btn_text );					}										var tb_content = "<div style=\"position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);\"><div style=\"text-align:center;\">" + response.message + "<div>" + button + "</div></div></div>";										$( "#TB_ajaxContent" ).html( tb_content );									},				beforeSend: function() {					$( "#TB_ajaxContent" ).html( "<div style=\"position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);\"><i class=\"fa fa-spinner fa-pulse fa-spin\"></i>&nbsp;Checking...</div>" );				},				error: function( jqXHR, textStatus, errorThrown ) {					$( "#TB_ajaxContent" ).html( "<div style=\"position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);\"><div style=\"text-align:center;\">Request Failed : "+errorThrown+"<div><button onclick=\"tb_remove();\">OK</button></div></div>" );					btn.html( btn_text );				}			});		}				$( ".pod-twilio-verify-number" ).live("click", function () {			var btn = $( this );			var contact_user_id = btn.data( "contact-user-id" );;			var btn_text = btn.text();							$.ajax({				url: pod_twilio.ajaxurl,				method: "post",				dataType: "json",				data: { "action" : "pod_twilio_verify_contact", "contact_user_id" : contact_user_id },				success: function ( result ){					$( "#TB_ajaxContent" ).html( "<div style=\"position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);\"><div style=\"text-align:center;\">"+result.message+"<div><button class=\"verify-ok\">OK</button></div></div></div>" );										$( ".verify-ok" ).click(function() {						check_number_verified( btn, contact_user_id );					});				},				beforeSend: function() {					tb_show('Verify Number', '#TB_inline?height=400&width=600&modal=true');										$( "#TB_ajaxContent" ).html( "<div style=\"position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);\"><i class=\"fa fa-spinner fa-pulse fa-spin\"></i>&nbsp;Please Wait...</div>" );										btn.html( btn_text+"&nbsp;<i class=\"fa fa-circle-o-notch fa-spin\"></i>" );				},				error: function( jqXHR, textStatus, errorThrown ) {					$( "#TB_ajaxContent" ).html( "<div style=\"position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);\"><div style=\"text-align:center;\">Request Failed : " + errorThrown + "<div><button onclick=\"tb_remove();\">OK</button></div></div>" );										btn.html( btn_text );				}			}); 		});	} );	} )(jQuery);/**	check if calculated amount is correct before submitting to paypal*/function check_validations() {	var call_price = parseFloat( pod_twilio.pod_twilio_master_ac_settings.call_cost_per_minute );	var call_duration = buy_call_duration.call_duration.value;	var total_price = parseFloat( call_duration * call_price ) . toFixed( 2 );	if( buy_call_duration.amount.value != total_price || total_price == 0) {		return false;	}	}function format_amount_with_currency( amount ) {	var currency_symbol = pod_twilio.pod_twilio_payment_settings.paypal_currency_symbol;	return currency_symbol + amount;}